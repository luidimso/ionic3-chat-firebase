{"version":3,"sources":["../../src/pages/chat/chat.module.ts","../../src/pages/chat/chat.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ChatPage } from './chat';\nimport { ComponentsModule } from '../../components/components.module';\n\n@NgModule({\n  declarations: [\n    ChatPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ChatPage),\n    ComponentsModule\n  ],\n})\nexport class ChatPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.module.ts","import { Component, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Content } from 'ionic-angular';\nimport { AuthService } from '../../providers/auth/auth';\nimport { UserService } from '../../providers/user/user';\nimport { User } from '../../models/user.model';\nimport { FirebaseListObservable, FirebaseObjectObservable } from 'angularfire2';\nimport { Message } from '../../models/message.model';\nimport { MessageService } from '../../providers/message/message';\nimport firebase from 'firebase';\nimport { Chat } from '../../models/chat.model';\nimport { ChatService } from '../../providers/chat/chat';\n\n@IonicPage()\n@Component({\n  selector: 'page-chat',\n  templateUrl: 'chat.html',\n})\nexport class ChatPage {\n  messages:FirebaseListObservable<Message[]>;\n  title:string;\n  sender:User;\n  recipient:User;\n  private chat1:FirebaseObjectObservable<Chat>;\n  private chat2:FirebaseObjectObservable<Chat>;\n  @ViewChild(Content) content:Content;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, public authService: AuthService, public userService: UserService, public messageService: MessageService, public chatService: ChatService) {\n  }\n\n  ionViewCanEnter():Promise<boolean>{\n    return this.authService.authenticated;\n  }\n\n  ionViewDidLoad(){\n    this.recipient = this.navParams.get(\"user\");\n    this.title = this.recipient.name;\n    this.userService.currentUser.first().subscribe((currentUser:User) => {\n      this.sender = currentUser;\n      this.chat1 = this.chatService.getChat(this.sender.$key, this.recipient.$key);\n      this.chat2 = this.chatService.getChat(this.recipient.$key, this.sender.$key);\n\n      if(this.recipient.photo){\n        this.chat1.first().subscribe((chat:Chat) => {\n          this.chatService.updatePhoto(this.chat1, chat.photo, this.recipient.photo);\n        });\n      }\n\n      let doSubscription = () => { //subscribe to messages database changes to execute scroll to bottom action\n        this.messages.subscribe((messages:Message[]) => {\n          this.scrollToBottom(0);\n        });\n      };\n\n      this.messages = this.messageService.getMessages(this.sender.$key, this.recipient.$key);\n      this.messages.first().subscribe((messages:Message[]) => {\n        if(messages.length == 0){\n          this.messages = this.messageService.getMessages(this.recipient.$key, this.sender.$key);\n          doSubscription();\n        } else {\n          doSubscription();\n        }\n      });\n    });\n  }\n\n  sendMessage(newMessage:string):void{\n    if(newMessage){\n      let timestamp:Object = firebase.database.ServerValue.TIMESTAMP;\n\n      this.messageService.create(new Message(this.sender.$key, newMessage, timestamp), this.messages).then(() => {\n        this.chat1.update({\n          lastMessage: newMessage,\n          timestamp: timestamp\n        });\n\n        this.chat2.update({\n          lastMessage: newMessage,\n          timestamp: timestamp\n        });\n      });\n    }\n  }\n\n  private scrollToBottom(duration?:number):void{\n    setTimeout(() => {\n      if(this.content && this.content.scrollToBottom){\n        this.content.scrollToBottom(duration || 300);\n      }\n    }, 50);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.ts"],"sourceRoot":""}